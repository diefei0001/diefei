# 网络层概述
> 网络层在主机和接收主机对之间传送IP数据报
- 传输层的TCP报文段与UDP的数据报被封装成IP数据报，通过网络层的功能进行传输
# 网络层的两个层面
> 网络层可以被分为数据层面和控制层面
- `数据层面`：对到来的分组进行处理和转发，是网络的实操层面
- `控制层面`：形成分组转发和处理的策略，是网络的理论层面
- 就像是一个加工厂，其必然有决定加工方法，制定加工规则的管理层，也有实施这些加工方法和加工规则的工人。
> 根据数据层面和控制层面的耦合程度，可以分为传统方式和SDN方式
- 路由器的数据层面对分组的处理依赖控制层面提供的方法和策略。传统方式中，[控制层面与数据层面是高度耦合的，路由器需要为自己的数据平面维护控制平面，同时与其他路由器进行控制信息的交换]，这个[控制平面是嵌入路由器内部的]。网络中存在多个分布式的，彼此通信的控制平面网络
- SDN，软件定义网络，[存在一个集中式的统一控制平面调度中心——SDN控制器对网络中的数据平面进行远程管理]。[控制平面和数据平面是解耦的].
# 路由和转发
> 网络层提供转发和路由两大功能
- 我们在概论中讲过网络层的路由和转发功能。如今我们进行更为详细的讨论。
  - 路由：[通过路由选择算法，决定分组从发送主机到目标接收主机的路径]
  - 转发，[将分组从路由器的输入接口转发到合适的输出接口]
> 转发是是发生在路由器局部的，而路由是基于网络全局而言的
- 我们进行简单的类比。假设我们要从北京坐高铁到香港，那么在到达北京西站时，我们规划从北京西坐到上海东，再从上海东做到深圳北，再从深圳北坐到香港西九龙。这个规划是路由。而到了上海东高铁站后后，从高铁站哪个口出站，从哪个口转站，这是转发。
> 转发是数据层面的主要任务，而路由是控制层面的主要任务
## 网络层提供的网络服务模型
> 网络服务模型定义了网络层向上层提供的服务特性和承诺，可以分为虚电路和数据报两种模式
### 虚电路模式
> 虚电路是类似于电路交换技术，在数据传输前建立端系统之间的逻辑连接，其核心是面向连接，路径预建立、状态维护、VCID标识。
- 虚电路是网络中的专线，虚电路实际上就是将端系统A和B之间分组路由和转发所涉及到的`路由器都提前预订`，路线上的`转发节点都维护双方的通信状态`，分组`只需要携带身份标识——VCID`(虚电路标识符)，路由器通过VCID识别分组，实现快速转发
- 也就是说，虚电路相当于在A，B两端套了个管道，[每个分组走的路径都是一样的]，不难理解的是，其可以保证分组在众多网络节点的转发中，维持有序性和稳定性。
> 数据报网络不建立端到端的特定连接，其核心是无连接，无状态、独立路由、尽力而为
- 数据报网络要求`分组携带完整的目标ip地址`，`每个节点为每个分组独立计算下一跳`，其算法`由控制平面全权决定，而与上一个分组无关`，因此是无状态的。
- 可想而知，[A到B的分组不一定走一样的顺序，自然不能保证分组有序到达，甚至存在分组丢失]，因此数据报网络是尽力而为的。
> 网络层使用数据报网络模型
- 虚电路看起来似乎有不得不选的理由，但是其代价不比其优点少。由于我们是自顶向下地学习，我们知道网络层并没有提供可靠数据传输，这个功能由传输层提供。这是因为网络设计存在`端到端原则`：
- [将复杂的功能（如可靠传输、顺序控制）放在网络边缘（终端主机）实现，而不是放在网络核心（路由器）。核心网络只做最简单的任务：尽力转发数据包。这使得核心路由器极其简单、高效、易于维护和扩展。]
- 讲白了，[网络层涉及的是网络核心部分，而核心部分追求的是稳定，兼容，简洁],就像是设计一个操作系统，你不会把各种乱七八糟的东西都在内核层面实现，这是一样的道理