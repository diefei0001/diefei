# 网络构成

>互联网是由多个网络相互连接而成的`网络的网络`,网络的基本构成是[端系统]、[通信链路]、[分组交换机]，彼此通过[通信链路]连接。

- 这是从宏观结构的角度进行概述。交换机接受并转发数据包，常见的有两种：[链路层交换机]和[路由器]

>链路层交换机是服务于局域网内部的`派件员`，路由器是服务于不同网络之间的`转运中心`
-------------------------------------------------------------------------------------------
# 网络结构

## 网络的基本结构
>网络结构可以分为[网络边缘]，[网络核心]，[接入网]三部分。

### 网络边缘与端系统的通信
>网络边缘由端系统构成，边缘系统是网络存在的理由。

>端系统上的网络应用的最常见通信模型是[C/S模式]和[P2P模式]。

- C/S模式最大的[缺点]是`可靠性`和`可拓展性差`，服务器高负载时处理能力会出现[断崖式下降]。
- p2p模式中，[每个节点既是客户端也是服务器]，在文件分发系统中很常用，节点向别的节点索求文件片段，同时也向其他节点提供自己的文件片段，这也是为什么像迅雷这种p2p文件分发系统,下载人数越多，下载速度越快的原因.

>端系统的通信服务有TCP和UDP两种。

- TCP称为`面向连接`的通信服务，所谓面向连接，就是两个端系统通信需要各自做好准备，这过程称为`握手`。TCP第一个特点是[可靠（reliable]*即数据是“原原本本”传递到目的端系统的;另一个特点是有[流量控制]，可以控制发送速率和接收速率;第三个特点是[拥塞控制]，即可以根据通信链路的拥塞情况.
- UDP称为`用户数据报协议`，这种连接方式是`无连接`的，也就是两个端系统通信前并提前不做好准备;UDP另一个特点是`不可靠`，即仅仅“尽全力”保证数据成功传输。

### 网络核心与数据交换技术
>网络核心是由路由器构成的网状系统，其核心功能是为两个处于网络边缘的端系统提供数据的转发和路由。

*路由：决定分组从源到宿的路径* | *转发:通过通信链路将数据进行传递*

>电路交换技术

- 在讨论分组交换技术前，需要了解的是[电路交换技术]，电路交换技术在两个端系统中建立一条宽大的链路，通过`频分多路复用`和`时分多路复用`等方式将链路分为若干线路,每对端系统的通信独享一条线路，这种技术的优点是`通信资源独享`，缺点是`建立连接需要时间`，且如果没有数据传输，资源就会被`浪费`，因此电路交换技术并不适合计算机网络。

>FDM 和 TDM是电路交换技术常用的多路复用技术

[频分复用：将总带宽划分为多个互不重叠的子频段，每个信道独占一个频段，本质是通过频率分割实现多路信号并行传输]
[时分复用：将时间划分为固定长度的时隙，每路信号轮流占用时隙传输，本质是通过时间片轮转实现多路信号分时共享同一信道]

>分组交换技术
- 网络核心实际通过[分组交换技术]实现`转发`和`路由`功能
- [分组交换技术以分组为单位进行存储与转发]。存储-转发，意味着数据首先被分割为小的数据（packet）转发到下一个节点，并等待后续所有分组到达后，再转发到下一跳（hop）。
- [分组交换技术的延迟要比线路交换高].因为每个节点都要等待分组全部到达，才进行下一跳的转发。这个转发方式似乎多此一举，但是其因此具有`共享性`。分组交换技术中，链路不再被分割，在端系统A和B进行通信的时候，连接A和B的一整条链路的每一段，并不是完全占用的，例如：
`                     A————1——————2———————3——————4——————B                                 `
在这一条链路中，假设A和B正在传输数据，因为1节点要等待全部packet到达，因此在这个时间内，仅`A——1`被占用，`1——2`，`2——3`，`3——4`，`4——B`都可以被[共享（sharing）]
- [事实上，分组交换技术也存在缺陷].当链路的输入速率大于输出速率的时候，会出现`排队`和`丢失`，这种情况一般见于多个端系统都需要通过某段链路的情况.当路由器的缓存用完，后续到达的分组将会丢失。

>分组交换网络又可以分为[数据报网络]和[虚电路网络].

- 二者的区别在于是否建立源主机和目标主机的网络层连接。前者每个分组都携带目`标主机的完整地址`，后者携带该`线路的虚电路号`.值得注意的是二者仍然是存储-转发模式，但封装的内容不同。

- 分组交换技术更能`适应网络的突发性`，`共享性更强`，因此能够`允许更多用户接入网络`。在网络大爆炸的今天，分组交换技术即使存在排队，丢失，时延更大的缺点，也是更适合互联网的转发技术。

### 接入网和物理媒体
> 接入网是网络边缘与网络核心连接的中介，常见的接入网有：住宅接入网，企业接入网，无线接入网
*住宅接入网：*
- `DSL模式`，[利用已有电话线网，通过调制解调]接入网络, 通过FDM，互联网和电话网分离。用户通过[连接DSL调制解调器，在splitter中划分频段，在co的数字用户接入复用器（DSLAM）被转换为数字形式]。
- `cable modem`模式，[利用有线电视信号线缆，通过调制解调]接入网络，通过FDM，实现互联网和电视网分离。常见的是HFC模式，[多个家庭通过一根同轴电缆接入光纤节点，再通过光纤接入电缆调制解调器终端接系统（CMTS）。]
- cable和DSL的一个明显区别是，[cable是共享线路，而DSL是独有线路]。
- FTTH模式，可以分为`AON`和`PON`。在PON模式中，[多个ONT（光纤网络端接器）单独一根光纤连接到一个splitter（分配器），最后用一根主干光纤连接到OLT，再接入CO]。FTTH是目前最主流的家庭接入网。
  
*企业接入网*
- `以太网`：多个端系统连接到`交换机`，交换机连接到`路由器`，进而连接到更高层的网络
- `无线LANs` ：无线局域网，在以太网的基础上，通过连接具有`ap功能的路由器`，[实现终端无线接入局域网。]

*无线接入网：*
- `蜂窝移动网络`：通过一个个类似蜂窝的`基站`实现广域的无线网络接入。

> 物理媒体是通信链路的物理实现，连接节点的物理介质,可以分为导引型媒体和非导引型媒体
- [导引型媒体指的是看得见的媒体]，例如`双绞铜线`，`同轴电缆`，`光纤`。[比特在介质内部传输]，而像电磁波等看[不见的媒体，称为非导引型媒体]。
-------------------------------------------------------------------------------------------
# 基于ISP的多层网络
> 端系统通过ISP接入互联网
- ISP称为`网络服务提供商`，我们知道，任意两个端系统都是互连的，因此ISP必然也是互连的。ISP通过部署ISP节点，收取费用供接入网连接。[ISP节点也成为了网络核心的重要组成部分]。
> 多级ISP之间互相连接，形成互联的网络
- ISP全球范围内数量很多，[ISP之间往往合作，互相连接]。ISP可以分为多个层级。 一级ISP`直接连接（称为对等）`或`通过IXP交换数据`，构成BBN；[区域ISP通过Pop接入上层ISP，接入ISP又接入区域ISP]，低层级的ISP可以同时接入多个上层ISP，称为`多宿`
> CPN是特殊的接入网
- ICP称为`网络内容提供商`，例如谷歌，百度等，同样的ICP也要接入ISP的网络。对于全球范围的ICP，接入ISP网络费用高昂，且服务质量一般。因此对于[全球范围服务的ICP，选择自建数据中心与链路，称为CPN]（内容提供商网络）
# 分组延时，丢失和吞吐量
> 分组丢失与延时发生的原因是分组到达链路的速率超过了链路输出的能力
> 分组延迟可以分为：节点处理延迟[`dproc`]，排队延迟[`dqueue`]，传输延迟[`dtrans`]，传播延迟[`dprop`]
- [节点处理延迟指的是对到达的分组进行检查所需的时间]，[排队延迟指分组被传输前在链路的等待时间]，[传输延迟指将分组发送到链路所需的“装箱”时间]，[传播延迟指分组从链路到达另一节点的“运输”时间]
- 传输单个bit所需的时间为`1/带宽R`,因此对于一个长度为L的分组，其传输延迟为`L*1/R`
- 传播时延相当好理解，其延迟为路程/速度，即`链路长度d/物理媒体传播速度s`，即`d/s`
> 流量强度在0到1的区间，当I趋向于1时，dqueue趋向无限大
- 流量强度I=La/R，a是期望通过分组的数量
> 当排队延迟过大，链路发生拥塞，分组则会丢失
- 丢失的分组可能从源重传，可能从上一跳重传，也可能不重传。
> 吞吐量指的是源与宿之间实际数据传输的速率
- 吞吐量可以分为瞬时吞吐量和平均吞吐量，吞吐量与链路速率的区别在于前者是实际的，后者时理论上的。当从A到B的链路中，有的带宽小，有的带宽大，则吞吐量取决于最小的，称为`瓶颈链路`。事实上，在实际的吞吐计算中，还要考虑到多用户对带宽的影响，严谨来讲，[吞吐量取决于源到宿传输实际分配的带宽的最小值]
# 协议层次与服务模型
> 层次化方式实现复杂的网络功能
- [将网络复杂的功能分成功能明确的层次，各个层次实现各自的功能，并为上层通过接口提供服务。本层功能的实现也要通过接口访问下层所提供的服务，进而为上层提供更好的服务]。也就是说，各个层级的功能被封装，通过接口暴露。这种类似于SOC的`分而治之`思想使复杂的互联网更为清晰
> 下层通过服务实现上层之间的通信能力
- 上层使用下层服务的协议实体称为`服务用户`，SAP(服务访问点)的作用是[区分数据究竟该给哪个服务用户]
- 服务用户通过原语使用服务提供者提供的服务
> PUD是层与层之间传输的主要内容
- `SDU`是`服务数据单元`，来自上层。[SDU（body）与`头部信息`（header）一起构成本层`PDU（协议数据单元）`]本层的PUD又成为下一层（n-1）层的SDU
- 各层的PDU有其各自的名称，从应用层到物理层分别为：
     `应用报文（message）——报文段（message segment）——分组/数据报——帧（frame）——比特（bit）`
> 网络层次协议
- 计算机网络的功能实现都是对等的，两个端系统交换报文，A端发送报文，B端接受报文，B端执行的，其实是A端的逆操作，类似于压缩与解压。[因此，协议是建立在对等的层次的，是水平的]
> 常用的互联网分层模型
- OSI七层：[应用层——表示层——会话层——传输层——网络层——数据链路层——物理层]
- TCP/IP 四层模型：[应用层（4层）——传输层（3层）——网络层（2层）——网络接口层（1层）]
- 互联网协议栈：[应用层——传输层——网络层——链路层——物理层]
> 物理层实现数字数据与物理信号的互换，通过物理媒体介质实现数据的传输
> 链路层在`相邻两点`之间，传输以帧为单位的数据
> 网络层在`端到端`之间，传输以分组为单位的数据
> 传输层为应用层提供`建立、维护和取消传输连接的功能`，负责端到端的可靠数据传输
> 应用层是`互联网存在的理由`，该层为用于通信的应用程序和用于消息传输的底层网络提供接口
# 数据的封装和解封装
[数据从应用层的应用通过接口发出，经过每一层，都要添加本层的控制信息构成PDU，这个过程称为封装]
[去除对应层的控制信息的过程称为解封装]
[数据在传递的过程中，经过二层设备，则解封装至二层，然后重新封装。经过三层设备，则解封装至三层，然后重新封装，这就好比]
示例图：
![alt text](diefei\Markdown素材库\Markdown 素材\封装与解封装.png)