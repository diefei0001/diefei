# Docker的目标
> Docker的目标是创建一个“轻量级虚拟机”的体验，但它的本质并不是虚拟机。它不是在硬件层面进行虚拟化，而是在操作系统层面进行进程隔离。
![alt text](D:\Github code\diefei\Markdown素材库\Markdown 素材\Docker.png)
# Docker的原理
> Docker的核心原理由：命名空间，控制组，联合文件系统构成

> 命名空间（Namespaces）实现了不同容器之间的进程，网络，通信，文件系统，用户，主机名的隔离
-   [命名空间负责提供隔离性，让容器内的进程看不到其他容器或宿主机的进程]。Linux提供了多种类型的命名空间，Docker为每个容器创建了一套独立的命名空间。
1. *PID Namespace（进程隔离）*：
    容器内的进程认为自己的PID是1（初始化进程），看不到宿主机上的其他进程。docker exec进入容器后执行ps aux，只能看到容器内的进程。
2. *NET Namespace（网络隔离）*：
    每个容器有自己的网络设备（如eth0）、IP地址、端口和路由表。这就是为什么多个容器都可以绑定到80端口而不会冲突。
3. *IPC Namespace（进程间通信隔离）*：
    隔离System V IPC和POSIX消息队列。

4. *Mount Namespace（文件系统挂载隔离）*：
    容器拥有自己独立的文件系统挂载点视图。在容器内执行mount命令不会影响宿主机。

5. *UTS Namespace（主机名隔离）*：
   允许容器拥有自己的主机名和域名。
6. *User Namespace（用户隔离）*：
    隔离用户和用户组ID。可以将容器内的root用户映射到宿主机上的非root用户，增强了安全性。

> 控制组（Cgroups）实现了容器使用Host OS的资源量，优先级等
- 资源限制：你可以限制一个容器最多使用多少内存、多少CPU时间片。

- 优先级控制：可以设置哪些容器可以获得更多的CPU时间或磁盘I/O带宽。

- 资源审计：监控每个容器的资源使用情况。

- 控制：冻结、挂起或重启容器。
> 联合文件系统（Union File System）将镜像分为了只读层，可写层
- [Docker镜像由一系列只读层（read-onlylayers）组成]。每一层代表Dockerfile中的一条指令，
- 当从一个镜像启动容器时，[Docker会在只读的镜像层之上添加一个可写的薄薄容器层（container-layer）。所有对文件的修改（增、删、改）都发生在这个可写层中]。
- 如果需要修改一个只读层中的文件，`CoW机制`会先将该文件复制到可写层，然后再修改。这最大限度地减少了磁盘使用量并提高了效率。
- 可写层的作用在于提供一个空间存放镜像运行时的临时文件，日志等
# Docker的工作流程
> Docker围绕3个基本概念工作：镜像，容器，仓库

> 镜像是一个基于Union FS 的特殊的分层文件系统
- [除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等]。
> 容器是镜像运行的实例，其本质是基于镜像的，拥有自己命名空间的特殊进程
- [容器基于Docker的命名空间原理，可以实现容器与容器，容器与进程之间的各种隔离]。对于容器来说，命名空间让其成为井底之蛙，误认为自己独享整个操作系统
- 一个简单的`比喻`
    想象一栋大楼（宿主机操作系统）里有很多家公司（容器）。
    命名空间就像是给每家公司的办公室装上了单向 mirrors墙和隔音墙。
    公司A的员工只能看到自己办公室（PID Namespace）里的同事。
    公司A拥有自己独立的内部电话号码分机号（NET Namespace），可以直接拨打外线，但不会与公司B的分机号冲突。
    公司A可以随意布置自己办公室内的格局和家具（Mount Namespace），而不会影响大楼的其他部分。
    公司A可以给自己起一个公司名（UTS Namespace），比如“卓越科技”，而不必使用大楼的地址作为公司名。
    对于公司A内部的员工来说，他们完全感觉不到其他公司的存在，他们认为“卓越科技”就是这栋大楼的全部。这就是命名空间创造的“幻觉”。
> 容器通常使用Host OS 的数据卷存储数据，而不是可写层
- [容器提供隔离的计算环境来运行应用。数据卷提供可靠、高效、独立的存储空间来保存数据]。好处在于数据卷的生命周期独立于容器。删除容器不会自动删除其使用的数据卷，且IO性能更强
> 仓库实现了镜像的集中存储与分发
- 镜像在仓库的存储格式为`<仓库名>:<版本>`，如果没有指定版本，则会使用latest
- 常见的仓库有：官方仓库，以及其他国内外的镜像仓库，也可以搭建私有的仓库
